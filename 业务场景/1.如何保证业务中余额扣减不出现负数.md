### 问题：如何保证余额字段在扣钱时，不能出现负值？

答：

涉及点：MySQL数据类型，无符号（unsigned）属性的应用。

>  `money_int` int(15) **unsigned** DEFAULT '0',
>   `money_decimal` decimal(15, 2) **UNSIGNED** DEFAULT 0.00,



#### 1.验证现有数据如下：

> **如下两条sql语句 可以从数据库层面保证数据不会出现负数的情况。**

| id   | money_int | money_decimal |
| ---- | --------- | ------------- |
| 1    | 8         | 6.8           |

执行如下sql：

1.

~~~sql
update money set money_decimal=money_decimal-100 where id=1
~~~

报错：

1264 - **Out of range value for column** 'money_decimal' at row 1
时间: 0s

2.

~~~sql
update money set money_int=money_int-100 where id=1
~~~

报错：

1690 - **BIGINT UNSIGNED value is out of range in** '(`distributed-lock`.`money`.`money_int` - 100)'



#### 2.[MySQL数据类型：UNSIGNED存在的问题](https://www.cnblogs.com/blankqdb/archive/2012/11/03/blank_qdb.html)

1. UNSIGNED

   UNSIGNED属性就是将数字类型无符号化，与C、C++这些程序语言中的unsigned含义相同。

   例如，INT的类型范围是 **-2 147 483 648 ～ 2 147 483 647**， 

   ​           INT UNSIGNED的范围类型就是**0 ～ 4 294 967 295**。

   字段属性是UNSIGNED，无符号型，也就是说有这个**属性的数值类型都是正数**，**可描述的数据量就大了一倍**，主要适合这种必然是正整数，且不需要做数值运算的场景。

   

   如果unsigned类型的字段做运算，会出现如下问题：

   一个是在有运算操作场景时会出问题:

   ​		不要用字段之间相减，理想的负数结果不会出现，运算结果会出问题。

   > 对于这种数据类型做减法出负数的时候出现的，因为**UNSIGNED是无符号型，所以1-2就不等于-1**，**而是这种数据类型的最大值了**。

   另一个是不便于移植，因为是非标准sql，还有在32位的 php 里，整形数字如果大于 2147483647 一样会出问题，用了无符号也不能超过这个

| 类型         | 大小                                     | 范围（有符号）                                               | 范围（无符号）                                               | 用途            |
| :----------- | :--------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :-------------- |
| TINYINT      | 1 byte                                   | (-128，127)                                                  | (0，255)                                                     | 小整数值        |
| SMALLINT     | 2 bytes                                  | (-32 768，32 767)                                            | (0，65 535)                                                  | 大整数值        |
| MEDIUMINT    | 3 bytes                                  | (-8 388 608，8 388 607)                                      | (0，16 777 215)                                              | 大整数值        |
| INT或INTEGER | 4 bytes                                  | (-2 147 483 648，2 147 483 647)                              | (0，4 294 967 295)                                           | 大整数值        |
| BIGINT       | 8 bytes                                  | (-9,223,372,036,854,775,808，9 223 372 036 854 775 807)      | (0，18 446 744 073 709 551 615)                              | 极大整数值      |
| FLOAT        | 4 bytes                                  | (-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38) | 0，(1.175 494 351 E-38，3.402 823 466 E+38)                  | 单精度 浮点数值 |
| DOUBLE       | 8 bytes                                  | (-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) | 0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) | 双精度 浮点数值 |
| DECIMAL      | 对DECIMAL(M,D) ，如果M>D，为M+2否则为D+2 | 依赖于M和D的值                                               | 依赖于M和D的值                                               | 小数值          |